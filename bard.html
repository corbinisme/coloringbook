<html>
<head>
    <title>Jelly Coloring</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <style>
        .container {
            margin: auto;
            max-width: 612px;
        }
        #coloringCanvas {
            BOX-SHADOW: 0  0  29px -19PX #333;
            cursor: crosshair;
        }
        #canvasWrapper {padding-top: 50px;}
       
       
        #coloringTools {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: #ccc;
            
        }
        #coloringTools .container, #navigation .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            align-content: center;
            height: 100%;
        }
        #navigation {
            position: fixed;
            bottom: 0px;
            left: 0;
            width: 100%;
            height: 50px;
            background-color: #eee;
           
        }
    </style>
    <body>
        <div id="wrapper" class="container">
        
        <div id="canvasWrapper">
            
            <canvas id="coloringCanvas" width="612" height="792"></canvas>
        </div>
        
        <div id="coloringTools" >
            <div class="container">
        
            <div id="colorPicker">
                <button class="btn btn-sm btn-outline-secondary" onclick="coloring.changeColor('black')">Black</button>
                <button class="btn btn-sm btn-outline-secondary"  onclick="coloring.changeColor('red')">Red</button>
                <button class="btn btn-sm btn-outline-secondary"  onclick="coloring.changeColor('green')">Green</button>
                <button class="btn btn-sm btn-outline-secondary"  onclick="coloring.changeColor('blue')">Blue</button>
            </div>
            <div id="tools">
                <div class="btn-group">
                    <button class="btn btn-sm btn-secondary" onclick="coloring.isErasing = false">Draw</button>
                    <button class="btn btn-sm btn-secondary" onclick="coloring.isErasing = true">Erase</button>
                </div>
            </div>
            <div id="coloringThickness">
                <button class="btn btn-sm btn-outline-secondary" onclick="coloring.changeThickness(5)">Thin</button>
                <button class="btn btn-sm btn-outline-secondary" onclick="coloring.changeThickness(10)">Medium</button>
                <button class="btn btn-sm btn-outline-secondary" onclick="coloring.changeThickness(20)">Thick</button>
            </div>
        </div>
        </div>
        <div id="navigation">
            <div class="container">
            <div>
                <button class="btn btn-sm btn-outline-danger" onclick="coloring.reset()">Reset</button>
                <button class="btn btn-sm btn-outline-success" onclick="coloring.save()">Save</button>
            </div>
            <select id="pageSelect" class="form-select" style="width: auto">
                <option value="intro">Intro</option>
                <option value="command1">1st Commandment</option>
                <option value="command2">2nd Commandment</option>
                <option value="command3">3rd Commandment</option>
                <option value="command4">4th Commandment</option>
                <option value="command5">5th Commandment</option>
                <option value="command6">6th Commandment</option>
                <option value="command7">7th Commandment</option>
                <option value="command8">8th Commandment</option>
                <option value="command9">9th Commandment</option>
                <option value="command10">10th Commandment</option>
            </select>   
            
        </div>
        </div>
    </div>
        <script>
           var coloring = {
                canvas: null,
                canvasWrapper: document.getElementById("canvasWrapper"),
                ctx: null,
                currentPage: "intro",
                img: null,
                isErasing: false,
                imgSrc: "images/intro.png",
                drawing: false,
                color: "black",
                thickness: 5,
                imgOutlineCanvas: null,
                imgOutlineCtx: null,


                init: function() {
                    const self = this;
                    this.canvas = document.getElementById("coloringCanvas");
                    this.ctx = this.canvas.getContext("2d");

                    this.img = new Image();
                    this.img.onload = () => {
                        this.ctx.drawImage(this.img, 0, 0);
                    };
                    this.img.src = this.imgSrc;

                    this.canvas.addEventListener("mousedown", (e) => {
                        this.drawing = true;
                    });
                    this.canvas.addEventListener("mouseup", () => {
                        this.drawing = false;
                    });
                    this.canvas.addEventListener("mousemove", (e) => {
                        
                        self.drawLine(e);
                        
                    });
                    this.canvas.addEventListener('touchstart', function(e) {
                        e.preventDefault();
                        self.drawing = true;
                        console.log("touchstart")
                        var touch = e.touches[0];
                        self.drawLine(touch);
                    });
                    this.canvas.addEventListener('touchmove', function(e) {
                        e.preventDefault();
                        console.log("touchmove")
                        if (self.drawing) {
                        
                            var touch = e.touches[0];
                            self.drawLine(touch);
                        }
                    });
                    this.canvas.addEventListener('touchend', function() {
                        self.drawing = false;
                    });



                    this.binding();
                },
                updateImage: function(newImage) {
                    this.imgSrc = newImage;
                    this.img.src = this.imgSrc;
                    
                    
                },
                updateColor: function(newColor) {
                    this.color = newColor;
                },
                updateThisckness: function(newThickness) {
                    this.thickness = newThickness;
                },
                binding: function(){
                    document.getElementById("pageSelect").addEventListener("change", function(e){
                        let val = e.target.value;
                        let newImage = "images/" + val + ".png";
                        coloring.currentPage = val;
                        coloring.updateImage(newImage);
                        coloring.reset();
                    });
                },

                drawLine: function(e) {
                    if (this.drawing) {
                    this.ctx.beginPath();
                    this.ctx.lineWidth = this.thickness;
                    this.ctx.lineCap = "round";

                    if (this.isErasing) {
                        // If erasing, use the destination-out composite operation
                        //this.ctx.globalCompositeOperation = "destination-out";
                        this.ctx.strokeStyle = "rgba(255,255,255,1)"; // Color doesn't matter for erasing
                    } else {
                        // If drawing, use the source-over composite operation
                        this.ctx.globalCompositeOperation = "source-over";
                        this.ctx.strokeStyle = this.color;
                    }
                    
                    this.ctx.moveTo(e.clientX - this.canvas.offsetLeft, e.clientY - this.canvas.offsetTop);
                    this.ctx.lineTo(e.clientX - this.canvas.offsetLeft, e.clientY - this.canvas.offsetTop);
                    this.ctx.stroke();
                    this.ctx.closePath();
                    }

                    //this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    this.ctx.drawImage(this.img, 0, 0); // Redraw the image
                },

                changeColor: function(newColor) {
                    this.color = newColor;
                },

                changeThickness: function(newThickness) {
                    this.thickness = newThickness;
                },
                reset: function() {
                    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                    this.ctx.drawImage(this.img, 0, 0);
                },
                save: function() {
                    let dataURL = this.canvas.toDataURL();
                    let a = document.createElement("a");
                    a.href = dataURL;
                    a.download = "coloring.png";
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                }
            };

            coloring.init(); // Call the initialization function

            
        </script>
    </body>
</html>